export NVM_DIR="$HOME/.nvm"
export PROFILE="$HOME/.profile"

# Find the correct nvm init script
if [[ -s "/usr/local/opt/nvm/nvm.sh" ]]; then
  # Installed via homebrew
  export NVM_INIT_SCRIPT_DIR="/usr/local/opt/nvm"

elif [[ -s "$NVM_DIR/nvm.sh" ]]; then
  # Installed via https://github.com/creationix/nvm
  export NVM_INIT_SCRIPT_DIR="$NVM_DIR"
fi

# This loads nvm"
[[ -s "$NVM_INIT_SCRIPT_DIR/nvm.sh" ]] && source "$NVM_INIT_SCRIPT_DIR/nvm.sh"

# This sets path to node
node_path="$(which node)"

# Autoload add-zsh-hook
autoload -U add-zsh-hook

# Call `nvm use` automatically in a directory with a .nvmrc file.
# @see  https://github.com/creationix/nvm#zsh
__loadnvmrc() {
  if [[ -f .nvmrc && -r .nvmrc ]]; then
    nvm use &> /dev/null
  elif [[ $(nvm version) != $(nvm version default)  ]]; then
    nvm use default &> /dev/null
  fi
  # This sets path to node
  node_path="$(which node)"
  ln -sf "$node_path" "/usr/local/bin/node"
}

# Add method to zsh hook for `chpwd` commands
add-zsh-hook chpwd __loadnvmrc
