#!/usr/bin/env zsh
#
# LDAP Comparison with diff tool and pretty printed with bat
#-------------------------------------------------------------------------------

set -e

[[ $# -gt 0 ]] || {
  echo "Need at least 1 username"
  return 1
}

[[ $# -eq 1 ]] && {
  local user1="lgordon"
  local user2="$1"
}

[[ $# -eq 2 ]] && {
  local user1="$1"
  local user2="$2"
}

diff -u \
  <(ldapsearch -b cn=users,dc=ods,dc=twitter,dc=corp -h ldap.local.twitter.com -xLLL uid=$user1 | sort) \
  <(ldapsearch -b cn=users,dc=ods,dc=twitter,dc=corp -h ldap.local.twitter.com -xLLL uid=$user2 | sort) |
  bat --language=diff
