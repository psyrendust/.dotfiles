#!/usr/bin/env zsh
#
# exifcopy
# Copy the exif data from one video to another after using HandBrakeCLI.
#-------------------------------------------------------------------------------

set -e

# Get 2 arguments as input and output files and save them as variables
inputFile=$1
outputFile=$2

# Get a path to a temp output file for the exif data
tempOutputFile=$(mktemp)

# echo "inputFile: $inputFile"
# echo "outputFile: $outputFile"
# echo "tempOutputFile: $tempOutputFile"

# Copy the exif data from the input file to the temp output file
exiftool -sort -args \
  -CameraSerialNumber \
  -CreateDate \
  -DigitalZoom \
  -ExposureCompensation \
  -FieldOfView \
  -FileModifyDate \
  -FirmwareVersion \
  -FontName \
  -LensSerialNumber \
  -MajorBrand \
  -MediaCreateDate \
  -MediaModifyDate \
  -MinorVersion \
  -Model \
  -ModifyDate \
  -SerialNumberHash \
  -Sharpness \
  -TrackCreateDate \
  -TrackModifyDate \
  -WhiteBalance \
  $inputFile > $tempOutputFile

# Copy the exif data from the input file to the output file
exiftool -overwrite_original -tagsFromFile $inputFile $outputFile

# The -tagsFromFile option doesn't quite get all of the tags, so we need to
# copy the remaining tags from the temp output file generated by the -args
# flag to the output file
exiftool -overwrite_original -@ $tempOutputFile $outputFile

# Non-writeable tags:
# -ColorMode \
# -DeviceName \
# -ElectronicImageStabilization \
# -FileAccessDate \
# -FileInodeChangeDate \
# -GenBalance \
# -GenFlags \
# -GenGraphicsMode \
# -GenMediaVersion \
# -GenOpColor \
# -GraphicsMode \
# -HandlerClass \
# -HandlerDescription \
# -HandlerType \
# -MaximumShutterAngle \
# -MediaUniqueID \
# -MetadataVersion \
# -MetaFormat \
# -PlaybackFrameRate \
# -ProTune \
# -Rate \
# -SensorReadoutTime \
# -TextColor \
# -TextFace \
# -TextFont \
# -TextSize \
